name: Deploy to DO

on:
  push:
    branches:
      - lito_dev  # Remplacez par le nom de la branche que vous souhaitez surveiller

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Deploy to DigitalOcean
      env:
        DO_SSH_KEY: ${{ secrets.DO_SSH_KEY }}
        DO_HOST: ${{ secrets.DO_HOST }}
        DO_USERNAME: ${{ secrets.DO_USERNAME }}
      run: |
        echo "$DO_SSH_KEY" > deploy_key
        chmod 600 deploy_key
        scp -i deploy_key -r . $DO_USERNAME@$DO_HOST:/root/facilicty-management/facillity-management-backend
        ssh -i deploy_key $DO_USERNAME@$DO_HOST "cd /path/on/server && docker-compose up --build -d"
        rm -f deploy_key
